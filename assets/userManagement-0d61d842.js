import{f as se,h as de,i as re,r as ue,j as ie,k as ce}from"./authorityCenter-18404eb9.js";import"./minio-js-42aedebc.js";import{u as pe}from"./index-8725779b.js";import{_ as me,a as m,r as _e,B as fe,o as ve,b as d,c as h,e as D,f,g as e,u as s,y as z,i as c,w as o,E as u,t as ge,n as S,v as F,F as he,q as be,p as ye,l as we,j as Ve,k as xe}from"./index-96b49db5.js";import"./http-cffe2822.js";const ke=x=>(ye("data-v-5209e5bb"),x=x(),we(),x),Ce={class:"WH0"},Se={class:"WH11 colorw1 btp-left edgeDisInter BSR sp14",style:{position:"relative"}},Ue=ke(()=>f("span",{class:"commonFont"},"用户名   ",-1)),Re={class:"fromRight-11"},De={class:"WH12 colorw1 marginT-2 overFlowH edgeDisInter BSR sp14"},ze={style:{display:"flex"}},Ie={class:"marginT fromRight"},Ne=["src"],Ae={class:"dialog-footer"},Ee={__name:"userManagement",setup(x){const M=pe();let I=m([]),w=m(),N=m(),p=m(),n=m(),U=m(),b=m(),k=m(),C=_e({name:"",size:"10",page:"1"}),v=m();const j=fe(()=>({Authorization:localStorage.getItem("token")})),$=t=>{t.code==200?(v.value=t.data.url,console.log("11111",v.value),console.log("22222",t.data.url),u.success(t.message)):u.error(t.message||"上传失败")},L=t=>{const a=t.size/1024/1024<2;return a||u.error("Avatar picture size can not exceed 2MB!"),a},_=()=>{let t={name:w.value,size:C.size,page:C.page};de(t).then(a=>{console.log(a.data.data.users),I.value=a.data.data.users,N.value=a.data.data.count})},P=t=>{C.size=t,_()},H=t=>{C.page=t,_()},R=(t,a,r)=>{t=="add"?(b.value="add",n.value={account:"",name:"",phone:"",sex:"",password:"",role:"",avatar:""},p.value=!0,U.value="新增用户"):t=="delete"?re(r.id).then(i=>{i.data.code==200?(u.success(i.data.message),_()):u.error(i.data.message)}):t=="edit"&&(n.value=r,console.log("rulekjsahdf",n.value),v.value=r.avatar,b.value="edit",p.value=!0,U.value="修改用户")},J=t=>{let a={id:t.id,phone:t.phone};ue(a).then(r=>{console.log(r,"123123213213"),r.data.code==200?localStorage.getItem("userId")==t.id?(u.success("重置成功，请重新登录"),Ve.remove("token"),M.$reset(),xe.replace("/")):u.success(r.data.message):u.error(r.data.message)})};m();const O=()=>{if(!n.value.name||!n.value.account||!n.value.phone||!n.value.sex||!n.value.password||!n.value.role){u.error("请填写完整信息");return}if(b.value=="add"){let t=JSON.parse(JSON.stringify(n.value));t.avatar=v.value,ie(t).then(a=>{a.data.code==200?(u.success(a.data.message),_(),t.avatar=""):(u.error(a.data.message),_(),t.avatar="")})}else if(b.value=="edit"){let t=JSON.parse(JSON.stringify(n.value));t.avatar=v.value,console.log("rulekRjsahdf",t),ce(t).then(a=>{a.data.code==200?(u.success(a.data.message),_(),t.avatar=""):(u.error(a.data.message),_(),t.avatar="")})}p.value=!1},T=t=>{let a="";return k.value.forEach(r=>{r.id==t&&(a=r.name)}),a};return ve(()=>{_(),se().then(t=>{k.value=t.data.data,console.log("role111",k.value)})}),(t,a)=>{const r=d("el-input"),i=d("el-button"),A=d("Plus"),V=d("el-icon"),W=d("el-avatar"),y=d("el-table-column"),q=d("el-tag"),G=d("Refresh"),K=d("el-popconfirm"),Q=d("EditPen"),X=d("Delete"),Y=d("el-table"),Z=d("el-pagination"),ee=d("el-divider"),ae=d("el-upload"),g=d("el-form-item"),E=d("el-radio"),te=d("el-option"),le=d("el-select"),oe=d("el-form"),ne=d("el-dialog");return h(),D("div",Ce,[f("div",Se,[Ue,f("div",null,[e(r,{modelValue:s(w),"onUpdate:modelValue":a[0]||(a[0]=l=>z(w)?w.value=l:w=l),class:"selectwidth"},null,8,["modelValue"])]),c("     "),e(i,{type:"primary",onClick:_},{default:o(()=>[c("查询")]),_:1}),f("div",Re,[e(i,{type:"primary",onClick:a[1]||(a[1]=l=>R("add"))},{default:o(()=>[e(V,null,{default:o(()=>[e(A)]),_:1}),c("新增用户")]),_:1})])]),f("div",De,[e(Y,{data:s(I),style:{height:"94%"},"header-cell-class-name":"table_header","row-style":{fontSize:"14px",height:"10px"},"cell-style":{padding:"14px",height:"30px"}},{default:o(()=>[e(y,{label:"头像",align:"center",width:"width"},{default:o(l=>[e(W,{size:50,src:l.row.avatar},null,8,["src"])]),_:1}),e(y,{label:"账号",align:"center",width:"width",prop:"account"}),e(y,{label:"用户名",align:"center",width:"width",prop:"name"}),e(y,{label:"电话",align:"center",width:"width",prop:"phone"}),e(y,{label:"角色",align:"center",width:"width"},{default:o(l=>[e(q,{type:"success"},{default:o(()=>[c(ge(T(l.row.role)),1)]),_:2},1024)]),_:1}),e(y,{label:"操作",align:"center",width:"390"},{default:o(l=>[f("div",ze,[e(K,{"confirm-button-text":"确认","cancel-button-text":"取消",title:"是否重置密码",onConfirm:B=>J(l.row),onCancel:t.cancelEvent},{reference:o(()=>[e(i,{text:"",type:"primary",style:{width:"130"}},{default:o(()=>[e(V,null,{default:o(()=>[e(G)]),_:1}),c("重置密码")]),_:1})]),_:2},1032,["onConfirm","onCancel"]),e(i,{text:"",type:"primary",style:{width:"130"},onClick:B=>R("edit",l.$index,l.row)},{default:o(()=>[e(V,null,{default:o(()=>[e(Q)]),_:1}),c("编辑")]),_:2},1032,["onClick"]),e(i,{text:"",type:"primary",style:{width:"130"},onClick:B=>R("delete",l.$index,l.row)},{default:o(()=>[e(V,null,{default:o(()=>[e(X)]),_:1}),c("删除")]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"]),f("div",Ie,[e(Z,{"page-size":10,background:"",layout:"total, prev, pager, next, jumper",total:s(N),onSizeChange:P,onCurrentChange:H},null,8,["total"])])]),e(ne,{modelValue:s(p),"onUpdate:modelValue":a[10]||(a[10]=l=>z(p)?p.value=l:p=l),title:s(U),width:"27%","align-center":"",style:{height:"550px"}},{footer:o(()=>[f("span",Ae,[e(i,{onClick:a[9]||(a[9]=l=>z(p)?p.value=!1:p=!1)},{default:o(()=>[c("取消")]),_:1}),e(i,{type:"primary",onClick:O},{default:o(()=>[c(" 确认 ")]),_:1})])]),default:o(()=>[e(ee),e(oe,{"label-width":"100px",model:s(n),style:{"max-width":"90%",margin:"0 auto"}},{default:o(()=>[s(b)=="edit"?(h(),S(g,{key:0,label:"头像",prop:"avatar"},{default:o(()=>[e(ae,{class:"avatar-uploader btp",action:"http://1.13.163.6:8091/image/upload","show-file-list":!1,headers:j.value,"on-success":$,"before-upload":L,name:"image"},{default:o(()=>[s(v)?(h(),D("img",{key:0,src:s(v),class:"avatar"},null,8,Ne)):(h(),S(V,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[e(A)]),_:1}))]),_:1},8,["headers"])]),_:1})):F("",!0),e(g,{label:"用户名",prop:"name"},{default:o(()=>[e(r,{modelValue:s(n).name,"onUpdate:modelValue":a[2]||(a[2]=l=>s(n).name=l)},null,8,["modelValue"])]),_:1}),e(g,{label:"电话",prop:"phone"},{default:o(()=>[e(r,{modelValue:s(n).phone,"onUpdate:modelValue":a[3]||(a[3]=l=>s(n).phone=l)},null,8,["modelValue"])]),_:1}),e(g,{class:"sexclass",label:"性别",prop:"sex"},{default:o(()=>[e(E,{modelValue:s(n).sex,"onUpdate:modelValue":a[4]||(a[4]=l=>s(n).sex=l),label:"男"},{default:o(()=>[c("男")]),_:1},8,["modelValue"]),e(E,{modelValue:s(n).sex,"onUpdate:modelValue":a[5]||(a[5]=l=>s(n).sex=l),label:"女"},{default:o(()=>[c("女")]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"账号",prop:"account"},{default:o(()=>[e(r,{modelValue:s(n).account,"onUpdate:modelValue":a[6]||(a[6]=l=>s(n).account=l)},null,8,["modelValue"])]),_:1}),s(b)=="add"?(h(),S(g,{key:1,label:"密码",prop:"password"},{default:o(()=>[e(r,{modelValue:s(n).password,"onUpdate:modelValue":a[7]||(a[7]=l=>s(n).password=l),"show-password":""},null,8,["modelValue"])]),_:1})):F("",!0),e(g,{label:"角色",prop:"role"},{default:o(()=>[e(le,{modelValue:s(n).role,"onUpdate:modelValue":a[8]||(a[8]=l=>s(n).role=l),clearable:""},{default:o(()=>[(h(!0),D(he,null,be(s(k),l=>(h(),S(te,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Le=me(Ee,[["__scopeId","data-v-5209e5bb"]]);export{Le as default};
