import{a as me,b as ge,d as _e,u as be,e as ke}from"./authorityCenter-18404eb9.js";import{_ as ye,a as r,r as Ee,o as we,b as v,c as D,e as Se,f as w,g as t,u as c,y as J,i as m,w as s,H as N,n as G,v as W,p as Ce,l as Ne,E as K}from"./index-96b49db5.js";import"./http-cffe2822.js";const xe=A=>(Ce("data-v-bdec2539"),A=A(),Ne(),A),Ve={class:"WH0"},Te={class:"WH11 colorw1 btp-left edgeDisInter BSR sp14",style:{position:"relative"}},Ue=xe(()=>w("span",{class:"commonFont"},"角色名   ",-1)),Me={class:"fromRight-11"},Oe={class:"WH12 colorw1 marginT-2 overFlowH edgeDisInter BSR sp14"},Re={class:"marginT fromRight"},De={class:"dialog-footer"},Je={__name:"roleManagement",setup(A){let Q=r([]),y=r(!1),g=r(!1);const x=r();r(5);let X=r(!1),S=r(),j=r(),f=r(),V=r(),T=r(!0),P=r(),U=r(),F=r(),I=r(),E=r(!1),$=r(!0),Y=r(),Z=r(!1),b=[{url:"1",label:"GET",children:[]},{url:"2",label:"POST",children:[]},{url:"3",label:"PUT",children:[]},{url:"4",label:"DELETE",children:[]}],_=r([]),q=Ee({name:"",size:"10",page:"1"});const k=()=>{let a={name:U.value,size:q.size,page:q.page};me(a).then(e=>{Q.value=e.data.data.roles,j.value=e.data.data.count})},B=(a,e)=>{let n=[];n=a.filter(l=>l.method==e),n.forEach(l=>{l.method=="GET"?b[0].children.push({url:l.url,label:l.url,method:l.method,disabled:!1}):l.method=="POST"?b[1].children.push({url:l.url,label:l.url,method:l.method,disabled:!1}):l.method=="PUT"?b[2].children.push({url:l.url,label:l.url,method:l.method,disabled:!1}):l.method=="DELETE"&&b[3].children.push({url:l.url,label:l.url,method:l.method,disabled:!1})})},oe=async()=>{let a=[];await ge().then(e=>{a=e.data.data}),a.forEach(e=>{if(e.children){let n=[];e.children.forEach(l=>{let d=[];l.children&&(l.children.forEach(i=>{d.push({value:i.value,label:i.label,code:i.code,children:null,disabled:!1,center:e.value})}),n.push({value:l.value,label:l.label,code:l.code,children:d,disabled:!1,center:e.value}))}),_.value.push({value:e.value,label:e.label,code:e.code,children:n,disabled:!1,center:e.value})}else _.value.push({value:e.value,label:e.label,code:e.code,children:null,disabled:!1,center:e.value})}),console.log("treeMenu",_.value),console.log(123)},ne=async()=>{await _e().then(a=>{P.value=a.data.data.apis,console.log(a),B(a.data.data.apis,"GET"),B(a.data.data.apis,"POST"),B(a.data.data.apis,"PUT"),B(a.data.data.apis,"DELETE")}),console.log(123)},L=a=>{a.forEach(e=>{e.children===[]||e.children===void 0?e.disabled=T.value:L(e.children)})},z=a=>{a.forEach(e=>{e.children?z(e.children):e.disabled=$.value})};let se=r([]);const C=(a,e,n)=>{if(a=="look"){T.value=!0,console.log("asdf",b),L(b),S.value="查看角色api";let l=r([]);if(n.apis){n.apis.forEach(i=>{let o={url:i.url,label:i.url,method:i.method};l.value.push(o)});let d=JSON.parse(JSON.stringify(l.value));console.log("1111",d),N(()=>{x.value.setCheckedNodes(d)})}else{let d=JSON.parse(JSON.stringify(l.value));console.log("1111",d),N(()=>{x.value.setCheckedNodes(d)})}X.value=!0,y.value=!0}else if(a=="lookMenus"){$.value=!0,z(_.value),Y.value="查看角色权限";let l=r([]);if(n.codes.length>0&&n.centers.length>0){n.codes.forEach(i=>{_.value.forEach(o=>{o.children?o.children.forEach(h=>{h.children.forEach(p=>{if(p.code==i){let R={value:p.value,label:p.label,code:p.code};l.value.push(R)}})}):n.centers.forEach(h=>{if(o.value==h){let p={value:o.value,label:o.label,code:o.code};l.value.push(p)}})})});let d=JSON.parse(JSON.stringify(l.value));console.log("1111",d),N(()=>{V.value.setCheckedNodes(d)})}else if(n.codes.length==0&&n.centers.length>0){console.log("asdfgf",n.codes),n.centers.forEach(i=>{_.value.forEach(o=>{if(o.value==i){let h={value:o.value,label:o.label,code:o.code};l.value.push(h)}})});let d=JSON.parse(JSON.stringify(l.value));N(()=>{V.value.setCheckedNodes(d)})}Z.value=!0,E.value=!0}else if(a=="edit")M.value=n.centers,O.value=n.codes,T.value=!1,L(b),S.value="修改角色",f.value=JSON.parse(JSON.stringify([Q.value[e]][0])),g.value=!0;else if(a=="editapi"){console.log("editapi"),S.value="修改角色api",F.value="editapi",T.value=!1,L(b),console.log(e);let l=r([]);e&&e.forEach(i=>{let o={url:i.url,label:i.url,method:i.method};l.value.push(o)});let d=JSON.parse(JSON.stringify(l.value));console.log(d),X.value=!0,y.value=!0,N(()=>{x.value.setCheckedNodes(d)})}else if(a=="editmenus"){F.value="editmenus",Y.value="修改角色权限",$.value=!1;let l=r([]);z(_.value),e.length>0&&n.length>0?e.forEach(i=>{_.value.forEach(o=>{o.children?o.children.forEach(h=>{h.children.forEach(p=>{if(p.code==i){let R={value:p.value,label:p.label,code:p.code,center:o.value};l.value.push(R)}})}):n.forEach(h=>{if(o.value==h){let p={value:o.value,label:o.label,code:o.code,center:o.value};l.value.push(p)}})})}):e.length==0&&n.length>0&&n.forEach(i=>{_.value.forEach(o=>{if(o.value==i){let h={value:o.value,label:o.label,code:o.code,center:o.value};l.value.push(h)}})});let d=JSON.parse(JSON.stringify(l.value));console.log("meniuused1",se.value),console.log("1111",d),Z.value=!0,E.value=!0,N(()=>{V.value.setCheckedNodes(d)})}else a=="add"&&(F.value="add",I.value="add",S.value="新增角色",f.value={name:"",apis:[],centers:[],codes:[]},g.value=!0)},ue=()=>{let a=x.value.getCheckedNodes().filter(n=>!n.children);console.log("111dsgafgawetrf",a);let e=[];a.forEach(n=>{let l={url:n.label,method:n.method};e.push(l)}),P.value=e,y.value=!1};let M=r([]),O=r([]);r([]);const de=()=>{let a=V.value.getCheckedNodes().filter(d=>!d.children);console.log("111dsgafgawetrf",a);let e=[],n=[];a.forEach(d=>{if(d.code){let i=d.code;e.push(i),n.push(d.center)}else n.push(d.value)});let l=[...new Set(n)];O.value=e,M.value=l,console.log("aaaaa",O.value),console.log("qqqqq",M.value),E.value=!1},ie=()=>{I.value!="add"?(f.value.apis=P.value,f.value.centers=M.value,f.value.codes=O.value,console.log(f.value,"ggggag"),be(f.value).then(a=>{a.data.code==200?(K.success(a.data.message),k()):(K.error(a.data.message),k())}),F.value=""):I.value=="add"&&(f.value.apis=P.value,f.value.centers=M.value,f.value.codes=O.value,ke(f.value).then(a=>{a.data.code==200?(K.success(a.data.message),k()):(K.error(a.data.message),k())}),I.value=""),g.value=!1},re=a=>{q.size=a,k()},ce=a=>{q.page=a,k()};return we(()=>{k(),ne(),oe()}),(a,e)=>{const n=v("el-input"),l=v("el-button"),d=v("Plus"),i=v("el-icon"),o=v("el-table-column"),h=v("Search"),p=v("EditPen"),R=v("el-table"),fe=v("el-pagination"),ve=v("el-divider"),H=v("el-form-item"),ee=v("Setting"),pe=v("el-form"),he=v("el-dialog"),le=v("el-tree"),ae=v("el-drawer");return D(),Se("div",Ve,[w("div",Te,[Ue,w("div",null,[t(n,{modelValue:c(U),"onUpdate:modelValue":e[0]||(e[0]=u=>J(U)?U.value=u:U=u),class:"selectwidth"},null,8,["modelValue"])]),m("     "),t(l,{type:"primary",onClick:k},{default:s(()=>[m("查询")]),_:1}),w("div",Me,[t(l,{type:"primary",onClick:e[1]||(e[1]=u=>C("add"))},{default:s(()=>[t(i,null,{default:s(()=>[t(d)]),_:1}),m("新增角色")]),_:1})])]),w("div",Oe,[t(R,{data:c(Q),style:{height:"94%"},"header-cell-class-name":"table_header","row-style":{fontSize:"14px",height:"10px"},"cell-style":{padding:"14px",height:"30px"}},{default:s(()=>[t(o,{label:"角色名称",prop:"name",align:"center",width:"width"}),t(o,{label:"角色接口",align:"center",width:"width"},{default:s(u=>[t(l,{text:"",type:"primary",onClick:te=>C("look",u.$index,u.row)},{default:s(()=>[t(i,null,{default:s(()=>[t(h)]),_:1}),m("查看角色api")]),_:2},1032,["onClick"])]),_:1}),t(o,{label:"角色权限",align:"center",width:"width"},{default:s(u=>[t(l,{text:"",type:"primary",onClick:te=>C("lookMenus",u.$index,u.row)},{default:s(()=>[t(i,null,{default:s(()=>[t(h)]),_:1}),m("查看角色权限")]),_:2},1032,["onClick"])]),_:1}),t(o,{label:"描述",prop:"desc",align:"center",width:"width"}),t(o,{label:"操作",align:"center",width:"width"},{default:s(u=>[t(l,{text:"",type:"primary",onClick:te=>C("edit",u.$index,u.row)},{default:s(()=>[t(i,null,{default:s(()=>[t(p)]),_:1}),m("编辑")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),w("div",Re,[t(fe,{"page-size":10,background:"",layout:"total, prev, pager, next, jumper",total:c(j),onSizeChange:re,onCurrentChange:ce},null,8,["total"])])]),t(he,{modelValue:c(g),"onUpdate:modelValue":e[8]||(e[8]=u=>J(g)?g.value=u:g=u),title:c(S),width:"25%","align-center":"",style:{height:"370px"}},{footer:s(()=>[w("span",De,[t(l,{onClick:e[6]||(e[6]=u=>J(g)?g.value=!1:g=!1)},{default:s(()=>[m("取消")]),_:1}),t(l,{type:"primary",onClick:e[7]||(e[7]=u=>ie())},{default:s(()=>[m(" 确认 ")]),_:1})])]),default:s(()=>[t(ve,{style:{margin:"5px 0 15px 0"}}),t(pe,{"label-width":"100px",model:c(f),style:{"max-width":"90%"}},{default:s(()=>[t(H,{label:"角色名称"},{default:s(()=>[t(n,{modelValue:c(f).name,"onUpdate:modelValue":e[2]||(e[2]=u=>c(f).name=u)},null,8,["modelValue"])]),_:1}),t(H,{label:"角色接口"},{default:s(()=>[t(l,{text:"",type:"primary",onClick:e[3]||(e[3]=u=>C("editapi",c(f).apis))},{default:s(()=>[t(i,null,{default:s(()=>[t(ee)]),_:1}),m("设置api")]),_:1})]),_:1}),t(H,{label:"描述"},{default:s(()=>[t(n,{modelValue:c(f).desc,"onUpdate:modelValue":e[4]||(e[4]=u=>c(f).desc=u)},null,8,["modelValue"])]),_:1}),t(H,{label:"权限选择"},{default:s(()=>[t(l,{text:"",type:"primary",onClick:e[5]||(e[5]=u=>C("editmenus",c(f).codes,c(f).centers))},{default:s(()=>[t(i,null,{default:s(()=>[t(ee)]),_:1}),m("设置权限")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(ae,{modelValue:c(y),"onUpdate:modelValue":e[9]||(e[9]=u=>J(y)?y.value=u:y=u),title:c(S)},{default:s(()=>[c(T)===!1?(D(),G(l,{key:0,type:"primary",onClick:ue},{default:s(()=>[m("保存")]),_:1})):W("",!0),c(X)?(D(),G(le,{key:1,data:c(b),ref_key:"refTree",ref:x,"show-checkbox":"","node-key":"url","default-expand-all":""},null,8,["data"])):W("",!0)]),_:1},8,["modelValue","title"]),t(ae,{modelValue:c(E),"onUpdate:modelValue":e[10]||(e[10]=u=>J(E)?E.value=u:E=u),title:c(Y)},{default:s(()=>[c($)===!1?(D(),G(l,{key:0,type:"primary",onClick:de},{default:s(()=>[m("保存")]),_:1})):W("",!0),c(Z)?(D(),G(le,{key:1,data:c(_),ref_key:"refTreeMenus",ref:V,"show-checkbox":"","node-key":"value","default-expand-all":""},null,8,["data"])):W("",!0)]),_:1},8,["modelValue","title"])])}}},Ie=ye(Je,[["__scopeId","data-v-bdec2539"]]);export{Ie as default};
