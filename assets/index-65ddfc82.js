import{d as We,a as i,r as je,o as qe,b as p,c as u,e as v,f as g,g as n,u as a,y as S,C as T,i as m,w as d,F as R,q as F,D as y,t as h,A as Qe,n as r,v as x,h as ve,G as me,H as z,E as b,p as Je,l as Xe,_ as Ye}from"./index-96b49db5.js";import{b as Ze,c as ze,d as el,e as ll,u as al}from"./device-ba57bdd3.js";import{b as tl}from"./group-6bd2387c.js";import"./http-cffe2822.js";const ee=H=>(Je("data-v-4e02d565"),H=H(),Xe(),H),ol={class:"WH0"},nl={class:"WH11 colorw1 btp-left edgeDisInter BSR sp14",style:{position:"relative"}},dl=ee(()=>g("span",{class:"commonFont"},"设备名称   ",-1)),sl=ee(()=>g("span",{class:"commonFont"},"设备类型   ",-1)),ul=ee(()=>g("span",{class:"commonFont"},"所属分组   ",-1)),il={class:"fromRight-11"},rl={class:"WH12 colorw1 marginT-2 overFlowH edgeDisInter BSR sp14"},cl={key:0},pl={key:1},vl={key:0},ml={key:1},gl={key:0},fl={key:1},_l={key:0},yl={key:1},hl={key:0},bl={key:1},kl={align:"center"},wl={class:"marginT fromRight"},Vl={class:"flex gap-2"},Tl={class:"flex gap-2"},xl={class:"dialog-footer"},Cl=We({__name:"index",setup(H){const B=i(""),k=i("");let C=i([]),D=i([]);const P=i(!1),G=i(!1),le=i(),ae=i();let M=i("0"),te=i(10);const ge=o=>{const e=C.value.indexOf(o);e>-1&&(C.value.splice(e,1),t.value.keys=[...C.value])},fe=()=>{P.value=!0,z(()=>{le.value.input.focus()})},oe=()=>{B.value.trim()&&(C.value.push(B.value.trim()),t.value.keys=[...C.value]),P.value=!1,B.value=""},_e=o=>{const e=D.value.indexOf(o);e>-1&&(D.value.splice(e,1),t.value.timeInterval=[...D.value])},ye=()=>{G.value=!0,z(()=>{ae.value.input.focus()})},ne=()=>{k.value.trim()=="0"||k.value.trim()=="1"||k.value.trim()=="2"||k.value.trim()=="3"?(D.value.push(Number(k.value.trim())),t.value.timeInterval=[...D.value]):(b.error("请输入正确的时间粒度"),console.log(k.value.trim(),typeof k.value.trim())),G.value=!1,k.value=""};let N=i(!1),I=i([]);const he=o=>{N.value=!0,I.value=o.map(e=>({label:` ${e}`}))},be=()=>{I.value=I.value.map(e=>({label:e.label.trim()})),console.log("saveSorts",I.value);let o=[];t.value.sort=I.value.map(e=>e.label),t.value.sort.forEach((e,s)=>{t.value.showKeys.forEach((c,K)=>{c==e&&o.push(e)})}),t.value.showKeys=o,N.value=!1,b.success("修改表头顺序成功")},ke=(o,e)=>{console.log("drag start",o)},we=(o,e,s)=>{console.log("tree drag enter:",e.label)},Ve=(o,e,s)=>{console.log("tree drag leave:",e.label)},Te=(o,e,s)=>{console.log("tree drag over:",e.label)},xe=(o,e,s,c)=>{console.log("tree drag end:",e&&e.label,s)},Ce=(o,e,s,c)=>{console.log("tree drop:",e.label,s),console.log("datazuihou",I.value)},De=(o,e,s)=>s!=="inner",Ie=o=>!o.data.label.includes("Level three 3-1-1");let E=i(!1),W=i([]),j=i();const Se=(o,e)=>{E.value=!0,W.value=o.map(c=>({label:`${c}`})),console.log("treeshowcol",W.value);let s=e.map(c=>({label:`${c}`}));console.log("showcol",s),z(()=>{j.value.setCheckedNodes(s)})},Ne=()=>{let o=j.value.getCheckedKeys();t.value.showKeys=o,console.log("aaaaaaaaaaaaaaa",o),E.value=!1,b.success("修改表头显示成功")};i();let de=i([]),se=i();i();let f=i(),L=i(),$=i(),A=i(),q=i(),ue=i(),ie=i(),Q=i("请选择"),J=i([{value:"dtu",label:"dtu"},{value:"cems",label:"cems"}]),re=i(),t=i({name:"",checkTime:"",code:"",Topic:"",type:"",groups:[],keys:[],timeInterval:[],sort:[],showKeys:[]}),w=i(!1),O=je({name:"",size:"10",page:"1"});const V=()=>{let o={name:L.value,type:$.value,id:A.value,size:O.size,page:O.page};Ze(o).then(e=>{se.value=e.data.data.count,de.value=e.data.data.devices}),ze().then(e=>{let s=e.data.data;s.forEach(c=>{c.children==null&&(c.disabled=!0)}),re.value=s}),tl().then(e=>{ue.value=e.data.data})},Ee=o=>{O.size=o,te.value=o,V()},Ke=o=>{O.page=o,V()},Ue=(o,e,s)=>{X(o,e,s)},Re=()=>{console.log("cancel!")},X=(o,e,s)=>{if(o=="add")w.value=!0,Q.value="请选择",q.value="新增设备",M.value="0",C.value=[],D.value=[],t.value={name:"",checkTime:"",code:"",Topic:"",type:"",groups:[],keys:[],timeInterval:[],sort:[],showKeys:[]},f.value="add";else if(o=="delete"){let c={_id:s.device._id,name:s.device.name,checkTime:s.device.checkTime,code:s.device.code,Topic:s.device.Topic,type:s.device.type,group:s.device.group};el(c).then(K=>{K.data.code==200?(b.success(K.data.message),V()):(b.error(K.data.message),V())})}else o=="edit"&&(w.value=!0,q.value="编辑设备",Q.value=s.group,ie.value=s.device.group,C.value=s.device.keys,D.value=s.device.timeInterval,s.device.type=="dtu"?M.value="0":s.device.type=="cems"&&(M.value="1"),t.value={_id:s.device._id,name:s.device.name,checkTime:s.device.checkTime,code:s.device.code,Topic:s.device.Topic,type:s.device.type,groups:[],keys:s.device.keys,timeInterval:s.device.timeInterval,sort:s.device.sort,showKeys:s.device.showKeys},f.value="edit",console.log("edit",t.value))},Fe=()=>{let o={_id:t.value._id,name:t.value.name,checkTime:Number(t.value.checkTime),code:t.value.code,Topic:t.value.Topic,type:t.value.type,sort:t.value.sort,showKeys:t.value.showKeys};if(f.value=="add")if(o.group=t.value.groups[1],o.keys=t.value.keys,o.timeInterval=t.value.timeInterval,t.value.name==""||t.value.code==""||t.value.Topic==""||t.value.type==""||t.value.checkTime==""){b.error("请完整填写信息");return}else ll(o).then(e=>{e.data.code==200?(b.success(e.data.message),V()):(b.error(e.data.message),V())});else if(f.value=="edit"){if(o.createTime=t.value.createTime,t.value.name==""){b.error("请完整填写信息");return}t.value.groups.length!=2?o.group=ie.value:o.group=t.value.groups[1],o.keys=t.value.keys,o.timeInterval=t.value.timeInterval,t.value.sort?o.sort=t.value.sort:o.sort=[],al(o).then(e=>{e.data.code==200?(b.success(e.data.message),V()):(b.error(e.data.message),V())})}w.value=!1,t.value={name:"",checkTime:"",code:"",Topic:"",type:"",groups:[],keys:[],timeInterval:[],sort:[],showKeys:[]}};return qe(()=>{V()}),(o,e)=>{const s=p("el-option"),c=p("el-select"),K=p("Plus"),Y=p("el-icon"),U=p("el-table-column"),Be=p("EditPen"),Le=p("Delete"),$e=p("el-popconfirm"),Ae=p("el-table"),He=p("el-pagination"),Me=p("el-divider"),_=p("el-form-item"),Oe=p("el-cascader"),ce=p("el-tag"),Pe=p("el-form"),Ge=p("el-dialog"),pe=p("el-tree");return u(),v("div",ol,[g("div",nl,[dl,g("div",null,[n(a(T),{modelValue:a(L),"onUpdate:modelValue":e[0]||(e[0]=l=>S(L)?L.value=l:L=l),class:"selectwidth"},null,8,["modelValue"])]),m("     "),sl,g("div",null,[n(c,{modelValue:a($),"onUpdate:modelValue":e[1]||(e[1]=l=>S($)?$.value=l:$=l),clearable:"",class:"selectwidth"},{default:d(()=>[(u(!0),v(R,null,F(a(J),l=>(u(),r(s,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),m("     "),ul,g("div",null,[n(c,{modelValue:a(A),"onUpdate:modelValue":e[2]||(e[2]=l=>S(A)?A.value=l:A=l),clearable:"",class:"selectwidth"},{default:d(()=>[(u(!0),v(R,null,F(a(ue),l=>(u(),r(s,{key:l._id,label:l.name,value:l._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),m("     "),n(a(y),{type:"primary",onClick:V},{default:d(()=>[m("查询")]),_:1}),g("div",il,[n(a(y),{type:"primary",onClick:e[3]||(e[3]=l=>X("add"))},{default:d(()=>[n(Y,null,{default:d(()=>[n(K)]),_:1}),m("新增设备")]),_:1})])]),g("div",rl,[n(Ae,{data:a(de),style:{height:"94%"},"header-cell-class-name":"table_header","row-style":{fontSize:"14px",height:"10px"},"cell-style":{padding:"10px",height:"57px"}},{default:d(()=>[n(U,{label:"设备名称",width:"width",align:"center"},{default:d(l=>[l.row.device.name?(u(),v("div",cl,h(l.row.device.name),1)):(u(),v("div",pl,h("--")))]),_:1}),n(U,{label:"设备ID",width:"width",align:"center"},{default:d(l=>[l.row.device.code?(u(),v("div",vl,h(l.row.device.code),1)):(u(),v("div",ml,h("--")))]),_:1}),n(U,{label:"MQTT主题",width:"width",align:"center"},{default:d(l=>[l.row.device.Topic?(u(),v("div",gl,h(l.row.device.Topic),1)):(u(),v("div",fl,h("--")))]),_:1}),n(U,{label:"设备类型",width:"width",align:"center"},{default:d(l=>[l.row.device.type?(u(),v("div",_l,h(l.row.device.type),1)):(u(),v("div",yl,h("--")))]),_:1}),n(U,{label:"所属分组",width:"width",align:"center"},{default:d(l=>[l.row.group?(u(),v("div",hl,h(l.row.group),1)):(u(),v("div",bl,h("--")))]),_:1}),n(U,{label:"操作",align:"center",width:"230"},{default:d(l=>[g("div",kl,[n(a(y),{text:"",type:"primary",onClick:Z=>X("edit",l.$index,l.row)},{default:d(()=>[n(Y,null,{default:d(()=>[n(Be)]),_:1}),m("编辑")]),_:2},1032,["onClick"]),n($e,{"confirm-button-text":"确定","cancel-button-text":"取消",icon:o.InfoFilled,"icon-color":"#626AEF",title:"确定要删除吗?",onConfirm:Z=>Ue("delete",l.$index,l.row),onCancel:Re},{reference:d(()=>[n(a(y),{text:"",type:"primary"},{default:d(()=>[n(Y,null,{default:d(()=>[n(Le)]),_:1}),m("删除")]),_:1})]),_:2},1032,["icon","onConfirm"])])]),_:1})]),_:1},8,["data"]),g("div",wl,[n(He,{"page-size":a(te),background:"",layout:"total, sizes,prev, pager, next, jumper",total:a(se),onSizeChange:Ee,onCurrentChange:Ke},null,8,["page-size","total"])])]),n(Ge,{modelValue:a(w),"onUpdate:modelValue":e[18]||(e[18]=l=>S(w)?w.value=l:w=l),title:a(q),width:"30%","align-center":"",style:{height:"670px"}},{footer:d(()=>[g("span",xl,[n(a(y),{onClick:e[17]||(e[17]=l=>S(w)?w.value=!1:w=!1)},{default:d(()=>[m("取消")]),_:1}),n(a(y),{type:"primary",onClick:Fe},{default:d(()=>[m(" 确认 ")]),_:1})])]),default:d(()=>[n(Me,{style:{margin:"5px 0 15px 0"}}),n(Pe,{"label-width":"100px",model:a(t),style:{"max-width":"80%",margin:"0 auto"},class:Qe(a(f)=="add"?"addclass":"editclass")},{default:d(()=>[n(_,{label:"设备名称",prop:"name"},{default:d(()=>[n(a(T),{modelValue:a(t).name,"onUpdate:modelValue":e[4]||(e[4]=l=>a(t).name=l)},null,8,["modelValue"])]),_:1}),n(_,{label:"检查时间",prop:"checkTime"},{default:d(()=>[n(a(T),{modelValue:a(t).checkTime,"onUpdate:modelValue":e[5]||(e[5]=l=>a(t).checkTime=l)},null,8,["modelValue"])]),_:1}),n(_,{label:"所属分组",prop:"groups"},{default:d(()=>[n(Oe,{options:a(re),"show-all-levels":!1,modelValue:a(t).groups,"onUpdate:modelValue":e[6]||(e[6]=l=>a(t).groups=l),clearable:"",style:{width:"350px"},placeholder:a(Q)},null,8,["options","modelValue","placeholder"])]),_:1}),a(f)=="add"?(u(),r(_,{key:0,label:"设备ID",prop:"code"},{default:d(()=>[n(a(T),{modelValue:a(t).code,"onUpdate:modelValue":e[7]||(e[7]=l=>a(t).code=l)},null,8,["modelValue"])]),_:1})):x("",!0),a(f)=="edit"?(u(),r(_,{key:1,label:"设备ID",prop:"code"},{default:d(()=>[n(a(T),{modelValue:a(t).code,"onUpdate:modelValue":e[8]||(e[8]=l=>a(t).code=l),disabled:""},null,8,["modelValue"])]),_:1})):x("",!0),a(f)=="add"?(u(),r(_,{key:2,label:"设备主题",prop:"Topic"},{default:d(()=>[n(a(T),{modelValue:a(t).Topic,"onUpdate:modelValue":e[9]||(e[9]=l=>a(t).Topic=l)},null,8,["modelValue"])]),_:1})):x("",!0),a(f)=="edit"?(u(),r(_,{key:3,label:"设备主题",prop:"Topic"},{default:d(()=>[n(a(T),{modelValue:a(t).Topic,"onUpdate:modelValue":e[10]||(e[10]=l=>a(t).Topic=l),disabled:""},null,8,["modelValue"])]),_:1})):x("",!0),a(f)=="add"?(u(),r(_,{key:4,label:"设备类型",prop:"type"},{default:d(()=>[n(c,{modelValue:a(t).type,"onUpdate:modelValue":e[11]||(e[11]=l=>a(t).type=l),clearable:"",style:{width:"350px"}},{default:d(()=>[(u(!0),v(R,null,F(a(J),l=>(u(),r(s,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):x("",!0),a(f)=="edit"?(u(),r(_,{key:5,label:"设备类型",prop:"type"},{default:d(()=>[n(c,{modelValue:a(t).type,"onUpdate:modelValue":e[12]||(e[12]=l=>a(t).type=l),clearable:"",disabled:"",style:{width:"350px"}},{default:d(()=>[(u(!0),v(R,null,F(a(J),l=>(u(),r(s,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):x("",!0),a(M)=="0"?(u(),r(_,{key:6,label:"平均值计算",prop:"keys"},{default:d(()=>[g("div",Vl,[(u(!0),v(R,null,F(a(C),l=>(u(),r(ce,{key:l,closable:"","disable-transitions":!1,onClose:Z=>ge(l)},{default:d(()=>[m(h(l),1)]),_:2},1032,["onClose"]))),128)),P.value?(u(),r(a(T),{key:0,ref_key:"InputRef",ref:le,modelValue:B.value,"onUpdate:modelValue":e[13]||(e[13]=l=>B.value=l),class:"w-20",size:"small",onKeyup:ve(oe,["enter"]),onBlur:oe},null,8,["modelValue","onKeyup"])):(u(),r(a(y),{key:1,class:"button-new-tag",size:"small",onClick:fe},{default:d(()=>[m(" + New Tag ")]),_:1}))])]),_:1})):x("",!0),n(_,{label:"时间粒度",prop:"timeInterval"},{default:d(()=>[g("div",Tl,[(u(!0),v(R,null,F(a(D),l=>(u(),r(ce,{key:l,closable:"","disable-transitions":!1,onClose:Z=>_e(l)},{default:d(()=>[m(h(l),1)]),_:2},1032,["onClose"]))),128)),G.value?(u(),r(a(T),{key:0,ref_key:"InputRefTime",ref:ae,modelValue:k.value,"onUpdate:modelValue":e[14]||(e[14]=l=>k.value=l),class:"w-20",size:"small",onKeyup:ve(ne,["enter"]),onBlur:ne},null,8,["modelValue","onKeyup"])):(u(),r(a(y),{key:1,class:"button-new-tag",size:"small",onClick:ye},{default:d(()=>[m(" + New Tag ")]),_:1}))])]),_:1}),a(f)=="edit"?(u(),r(_,{key:7,label:"标头显示",prop:"sort"},{default:d(()=>[n(a(y),{type:"primary",onClick:e[15]||(e[15]=l=>Se(a(t).sort,a(t).showKeys))},{default:d(()=>[m("修改标头显示")]),_:1})]),_:1})):x("",!0),a(f)=="edit"?(u(),r(_,{key:8,label:"标头顺序",prop:"sort"},{default:d(()=>[n(a(y),{type:"primary",onClick:e[16]||(e[16]=l=>he(a(t).sort))},{default:d(()=>[m("修改标头顺序")]),_:1})]),_:1})):x("",!0)]),_:1},8,["model","class"])]),_:1},8,["modelValue","title"]),n(a(me),{modelValue:a(E),"onUpdate:modelValue":e[19]||(e[19]=l=>S(E)?E.value=l:E=l),title:"修改标头显示",style:{width:"100px"}},{default:d(()=>[n(a(y),{type:"primary",onClick:Ne},{default:d(()=>[m("保存")]),_:1}),n(pe,{data:a(W),ref_key:"refTreeShow",ref:j,"show-checkbox":"","node-key":"label","default-expand-all":""},null,8,["data"])]),_:1},8,["modelValue"]),n(a(me),{modelValue:a(N),"onUpdate:modelValue":e[20]||(e[20]=l=>S(N)?N.value=l:N=l),title:"修改标头顺序",style:{width:"100px"}},{default:d(()=>[n(a(y),{type:"primary",onClick:be},{default:d(()=>[m("保存")]),_:1}),n(pe,{style:{"max-width":"600px"},"allow-drop":De,"allow-drag":Ie,data:a(I),draggable:"","default-expand-all":"","node-key":"id",onNodeDragStart:ke,onNodeDragEnter:we,onNodeDragLeave:Ve,onNodeDragOver:Te,onNodeDragEnd:xe,onNodeDrop:Ce},null,8,["data"])]),_:1},8,["modelValue"])])}}});const El=Ye(Cl,[["__scopeId","data-v-4e02d565"]]);export{El as default};
